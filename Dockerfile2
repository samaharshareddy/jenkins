ARG BASE_IMAGE=harborrmz.unionbankofindia.co.in/apim-mule-repo/rhel95-base
FROM ${BASE_IMAGE}

ENV JAVA_HOME=/opt/jre
ENV MULE_HOME=/opt/mule
ENV PATH="${PATH}:${JAVA_HOME}/bin"

# Install tools
RUN yum install -y unzip curl jq && yum clean all

# Copy JRE & Mule runtime (already present on build server)
COPY jre*.tar.gz mule-*.zip /tmp/

RUN mkdir -p /opt/jre /opt/mule && \
    tar -xzf /tmp/jre*.tar.gz -C /opt/jre --strip-components=1 && \
    unzip -q /tmp/mule-*.zip -d /tmp && \
    mv /tmp/mule-* /opt/mule && \
    rm -rf /tmp/*

# ---- Application JAR (dynamic) ----
ARG JAR_FILE
COPY ${JAR_FILE} ${MULE_HOME}/apps/

RUN adduser --system mule && chown -R mule:mule /opt/mule
USER mule

CMD ["/opt/mule/bin/mule"]
